<!DOCTYPE html>
<html>
    <head>
        <title> Immortal_guardian </title>
    </head>
    <body>
        <h3> Immortal guardian </h3>
        <button id="getStats">Get Stats</button>
        <button id="doDamageButton">Do Damage</button>
        <div class="dialog-box">
            <p class="dialog-text" id="dialog-box"></p>
            <button class="dialog-button" id="next-button">Next</button>
            <table id="tabella_stats"></table>
        </div>
    </body>
    <script>
        function creaTabellaStats(json_value) {
            path_img = "Immortal_guardian.png"
            table = "";
            table += "<tr><td><img src=http://localhost:8080/m5/get-image/"+path_img+"></td></tr>"; 
            table += "<tr><td> Vita: "+json_value.Vita+"</td></tr>";
            table += "<tr><td> Vigore: "+json_value.Vigore+"</td></tr>";
            table += "<tr><td> Forza: "+json_value.Forza+"</td></tr>";
            table += "<tr><td> Destrezza: "+json_value.Destrezza+"</td></tr>";
            table += "<tr><td> Intelligenza: "+json_value.Intelligenza+"</td></tr>";
            table += "<tr><td> Fede: "+json_value.Fede+"</td></tr>";
            return table;
        } 

        function postData(url = '', data = {}) {
                return fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                })
                .then(response => response.json());
            }


        document.getElementById('doDamageButton').addEventListener('click', function() {
                /*const name = prompt("Enter player name:");
                const value = prompt("Enter damage value:");*/
                postData('http://localhost:8080/m5/api/do-damage-boss',{})
                    .then(data => {
                        document.getElementById('dialog-box').innerText = JSON.stringify(data, null, 2);
                    })
                    .catch(error => {
                        document.getElementById('dialog-box').innerText = 'Error: ' + error;
                    });
            });

        document.getElementById('getStats').addEventListener('click', function() {
                //const playerName = prompt("Enter player name:");
                fetch(`http://localhost:8080/m5/api/get-stats/`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(data)
                        table = creaTabellaStats(data.result)
                        document.getElementById('tabella_stats').innerHTML = table;
                    })
                    .catch(error => {
                        document.getElementById('result').innerText = 'Error: ' + error;
                    });
            });
        
            function sendToServer(request,data)
            {
                fetch("http://localhost:8080/m5/" + request,{
                    method:"POST", // metodo richiesta
                    headers:{'Content-Type':'application/json'},
                    body: JSON.stringify(data) // dati da inviare in formato json
                })
                .then((response)=>{ // prende la risposta del server
                    if(!response.ok) // in caso di errore manda stato risposta a console
                    {
                        alert('operazione fallita, riprovare o ricaricare la pagina'); // in caso di fallimento post
                        throw new Error(`error posting content to server: ${response.status}`); 
                    }
                    return response.json(); // restituisce la risposta data dal server
                })
                .then((result)=>{
                    console.log(result); // log risposta per debug
                })
                .catch((err)=>{ // catch errori
                    console.error('error sending data: ',err); // fa un log a console dell'errore
                    alert('operazione fallita, riprovare o ricaricare la pagina.\n\ncodice di errore: '+ err); // manda un alert con il codice di errore
                });
            }

            // funzione usata per fare il fetch dei dati dal server e passarli a una funzione data come parametro
            function fetchData(request,callback)
            {
                fetch("http://localhost:8080/m5/" + request) // fetch url con richiesta
                .then(response => {
                    if(!response.ok) // check stato risposta
                        throw new Error(`response fetch error ${response.status}`); // in caso di errore stampa lo stato a console
                    return response.json(); // ritorna la risposta codificata in json
                })
                .then(data => { // prende i dati ottenuti
                    console.log("fetched data: ");
                    console.log(data) // log dati per debug
                    callback(data); // chiama la funzione di callback a cui passare i dati ottenuti
                })
                .catch(err => { // catch dell'errore in modo da stamparlo a console
                    console.error('request error',err); // log dell'errore a console
                });
            }
    </script>
</html>